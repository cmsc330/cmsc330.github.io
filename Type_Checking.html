<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>9&nbsp;Type Checking</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="extra.css" title="default"/><link rel="stylesheet" type="text/css" href="fancyverb.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">CMSC 330 Lecture Notes</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="ocaml.html" class="tocviewlink" data-pltdoc="x">Functional Programming with OCaml</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Imperative_OCaml.html" class="tocviewlink" data-pltdoc="x">Imperative Programming with OCaml</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="pbt.html" class="tocviewlink" data-pltdoc="x">Property-<wbr></wbr>Based Randomized Testing</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="regexp.html" class="tocviewlink" data-pltdoc="x">OCaml Regular Expressions</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Finite_Automata.html" class="tocviewlink" data-pltdoc="x">Finite Automata</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="Context_Free_Grammars.html" class="tocviewlink" data-pltdoc="x">Context Free Grammars</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="Parsing.html" class="tocviewlink" data-pltdoc="x">Parsing</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="Operational_Semantics.html" class="tocviewlink" data-pltdoc="x">Operational Semantics</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Type Checking</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>9&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Type Checking</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">9.1&nbsp;</td><td><a href="#%28part._1-type-checking%29" class="tocviewlink" data-pltdoc="x">Type Checking</a></td></tr><tr><td align="right">9.2&nbsp;</td><td><a href="#%28part._1-subtyping%29" class="tocviewlink" data-pltdoc="x">Subtyping</a></td></tr><tr><td align="right">9.3&nbsp;</td><td><a href="#%28part._.Type_.Inference%29" class="tocviewlink" data-pltdoc="x">Type Inference</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">9.1<tt>&nbsp;</tt></span><a href="#%28part._1-type-checking%29" class="tocsubseclink" data-pltdoc="x">Type Checking</a></td></tr><tr><td><span class="tocsublinknumber">9.2<tt>&nbsp;</tt></span><a href="#%28part._1-subtyping%29" class="tocsubseclink" data-pltdoc="x">Subtyping</a></td></tr><tr><td><span class="tocsublinknumber">9.3<tt>&nbsp;</tt></span><a href="#%28part._.Type_.Inference%29" class="tocsubseclink" data-pltdoc="x">Type Inference</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.17</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Operational_Semantics.html" title="backward to &quot;8 Operational Semantics&quot;" data-pltdoc="x" rel="prev">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;CMSC 330 Lecture Notes&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h3 class="heading">9<tt>&nbsp;</tt><a name="(part._.Type_.Checking)"></a>Type Checking<span class="button-group"><a href="#(part._.Type_.Checking)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._1-type-checking%29" class="toclink" data-pltdoc="x">9.1<span class="hspace">&nbsp;</span>Type Checking</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._1-subtyping%29" class="toclink" data-pltdoc="x">9.2<span class="hspace">&nbsp;</span>Subtyping</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Type_.Inference%29" class="toclink" data-pltdoc="x">9.3<span class="hspace">&nbsp;</span>Type Inference</a></p></td></tr></table><h4 class="heading">9.1<tt>&nbsp;</tt><a name="(part._1-type-checking)"></a>Type Checking<span class="button-group"><a href="#(part._1-type-checking)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>Coming soon</p><h4 class="heading">9.2<tt>&nbsp;</tt><a name="(part._1-subtyping)"></a>Subtyping<span class="button-group"><a href="#(part._1-subtyping)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>Coming soon</p><h4 class="heading">9.3<tt>&nbsp;</tt><a name="(part._.Type_.Inference)"></a>Type Inference<span class="button-group"><a href="#(part._.Type_.Inference)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p><div class="SIntrapara">A simple type inference code example:
</div><div class="SIntrapara"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">OCaml REPL</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> exptype = </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    | TInt </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    | TBool </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    | TArrow <span class="kw">of</span> exptype * exptype </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    | Guess_t <span class="kw">of</span> <span class="dt">int</span> * exptype <span class="dt">option</span> <span class="dt">ref</span>;; </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a> <span class="kw">type</span> op = Add | Sub | Mult | Equal | NotEqual;; </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a> <span class="kw">type</span> var = <span class="dt">string</span>;; </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a> <span class="kw">type</span> expr = </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    | Int <span class="kw">of</span> <span class="dt">int</span> </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    | Binop <span class="kw">of</span> op * expr * expr </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    | Bool <span class="kw">of</span> <span class="dt">bool</span> </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    | If <span class="kw">of</span> expr * expr * expr </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    | ID <span class="kw">of</span> var </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    | Fun <span class="kw">of</span> var * expr </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    | App <span class="kw">of</span> expr * expr </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    | Let <span class="kw">of</span> var * expr * expr;; </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> <span class="kw">rec</span> string_of_exptype t = </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">match</span> t <span class="kw">with</span> </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    | TInt -&gt; <span class="st">&quot;int&quot;</span> </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    | TBool -&gt; <span class="st">&quot;bool&quot;</span> </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    | TArrow (t1, t2) -&gt; </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;(&quot;</span> ^ string_of_exptype t1 ^ <span class="st">&quot;-&gt;&quot;</span> ^ string_of_exptype t2 ^ <span class="st">&quot;)&quot;</span> </span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    | Guess_t (i, { contents = <span class="dt">None</span> }) -&gt; <span class="dt">Printf</span>.sprintf <span class="st">&quot;?%d&quot;</span> i </span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    | Guess_t (_, { contents = <span class="dt">Some</span> t }) -&gt; string_of_exptype t;; </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a> <span class="kw">type</span> &#39;a env = (var * &#39;a) <span class="dt">list</span>;; </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a> <span class="kw">exception</span> TypeError <span class="kw">of</span> <span class="dt">string</span>;; </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> error (s : <span class="dt">string</span>) = <span class="dt">raise</span> (TypeError s);; </span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> extend (env : &#39;a env) (x : var) (v : &#39;a) : &#39;a env = (x, v) :: env;; </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> <span class="kw">rec</span> lookup (env : &#39;a env) (x : var) : &#39;a = </span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">match</span> env <span class="kw">with</span> </span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    | [] -&gt; error (<span class="st">&quot;unbound variable&quot;</span> ^ x) </span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    | (y, v) :: rest -&gt; <span class="kw">if</span> x = y <span class="kw">then</span> v <span class="kw">else</span> lookup rest x;; </span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> fresh_guess = </span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> guess_counter = <span class="dt">ref</span> <span class="dv">0</span> <span class="kw">in</span> </span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fun</span> () : exptype -&gt; </span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> c = !guess_counter <span class="kw">in</span> </span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>      guess_counter := c + <span class="dv">1</span>; </span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>      Guess_t (c, <span class="dt">ref</span> <span class="dt">None</span>);; </span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a> <span class="co">(* path compression -- compress a path of constrained guesses, so that </span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="co">       the guess refers to the most constrained type. *)</span> </span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> <span class="kw">rec</span> compress (t : exptype) : exptype = </span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">match</span> t <span class="kw">with</span> </span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    | Guess_t (_, ({ contents = <span class="dt">Some</span> t&#39; } <span class="kw">as</span> r)) -&gt; </span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> t&#39;&#39; = compress t&#39; <span class="kw">in</span> </span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        r := <span class="dt">Some</span> t&#39;&#39;; </span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>        t&#39;&#39; </span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    | Guess_t (_, { contents = <span class="dt">None</span> }) | TInt | TBool | TArrow (_, _) -&gt; t;; </span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a> <span class="co">(* occurs check -- determine if a guess is in a type *)</span> </span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> <span class="kw">rec</span> occurs (r : exptype <span class="dt">option</span> <span class="dt">ref</span>) (t : exptype) : <span class="dt">bool</span> = </span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    <span class="kw">match</span> t <span class="kw">with</span> </span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    | Guess_t (_, r&#39;) -&gt; r == r&#39; </span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    | TArrow (t1, t2) -&gt; occurs r t1 || occurs r t2 </span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    | TInt | TBool -&gt; <span class="kw">false</span>;; </span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> <span class="kw">rec</span> unify (t1 : exptype) (t2 : exptype) : <span class="dt">unit</span> = </span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> t1 == t2 <span class="kw">then</span> () </span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="kw">else</span> </span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>      <span class="kw">match</span> (compress t1, compress t2) <span class="kw">with</span> </span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>      | Guess_t (_, ({ contents = <span class="dt">None</span> } <span class="kw">as</span> r)), t </span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>      | t, Guess_t (_, ({ contents = <span class="dt">None</span> } <span class="kw">as</span> r)) -&gt; </span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>          <span class="kw">if</span> occurs r t <span class="kw">then</span> </span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>            error </span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>              (<span class="dt">Printf</span>.sprintf <span class="st">&quot;occurs check failed:  %s &lt;&gt; %s&quot;</span> </span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>                 (string_of_exptype t1) (string_of_exptype t2)) </span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>          <span class="kw">else</span> r := <span class="dt">Some</span> t; </span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>          <span class="dt">print_string</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Type:&quot;</span>; </span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>          <span class="dt">print_string</span> </span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>            (<span class="kw">match</span> !r <span class="kw">with</span> <span class="dt">Some</span> x -&gt; string_of_exptype x | <span class="dt">None</span> -&gt; <span class="st">&quot;None&quot;</span>) </span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>      | TArrow (t1a, t1b), TArrow (t2a, t2b) -&gt; </span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>          unify t1a t2a; </span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>          unify t1b t2b </span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>      | TBool, TBool -&gt; () </span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>      | TInt, TInt -&gt; () </span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>      | t1, t2 -&gt; </span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>          error </span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>            (<span class="dt">Printf</span>.sprintf <span class="st">&quot;unify failure: %s &lt;&gt; %s&quot;</span> (string_of_exptype t1) </span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>               (string_of_exptype t2));; </span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> <span class="kw">rec</span> infer (e : expr) (env : exptype env) : exptype = </span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    <span class="kw">match</span> e <span class="kw">with</span> </span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>    | Int _ -&gt; TInt </span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>    | Bool _ -&gt; TBool </span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>    | ID x -&gt; lookup env x </span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>    | Binop (Add, e1, e2) | Binop (Sub, e1, e2) | Binop (Mult, e1, e2) -&gt; </span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>        unify (infer e1 env) TInt; </span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>        unify (infer e2 env) TInt; </span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>        TInt </span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>    | Binop (Equal, e1, e2) | Binop (NotEqual, e1, e2) -&gt; </span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>        unify (infer e1 env) (infer e2 env); </span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>        TBool </span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>    | If (e1, e2, e3) -&gt; </span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>        unify (infer e1 env) TBool; </span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> t2 = infer e2 env <span class="kw">in</span> </span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> t3 = infer e3 env <span class="kw">in</span> </span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>        unify t2 t3; </span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>        t2 </span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>    | Let (x, e1, e2) -&gt; infer e2 (extend env x (infer e1 env)) </span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>    | Fun (x1, e1) -&gt; </span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> g = fresh_guess () <span class="kw">in</span> </span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>        TArrow (g, infer e1 (extend env x1 g)) </span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>    | App (e1, e2) -&gt; </span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> t1 = infer e1 env <span class="kw">in</span> </span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> t2 = infer e2 env <span class="kw">in</span> </span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> g = fresh_guess () <span class="kw">in</span> </span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>        unify t1 (TArrow (t2, g)); </span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>        g </span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a> ;; </span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a> <span class="co">(* 3 + 4*2 *)</span> </span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> e1 = Binop (Add, Int <span class="dv">3</span>, Binop (Mult, Int <span class="dv">4</span>, Int <span class="dv">2</span>));; </span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> e2 = Binop (Equal, Int <span class="dv">3</span>, Binop (Mult, Int <span class="dv">4</span>, Int <span class="dv">2</span>));; </span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> e3 = If (Bool <span class="kw">true</span>, Int <span class="dv">3</span>, Int <span class="dv">4</span>);; </span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> e4 = Let (<span class="st">&quot;x&quot;</span>, Int <span class="dv">1</span>, Binop (Add, Int <span class="dv">10</span>, ID <span class="st">&quot;x&quot;</span>));; </span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> e5 = Let (<span class="st">&quot;f&quot;</span>, Fun (<span class="st">&quot;x&quot;</span>, Binop (Add, Int <span class="dv">3</span>, ID <span class="st">&quot;x&quot;</span>)), App (ID <span class="st">&quot;f&quot;</span>, Int <span class="dv">4</span>));; </span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> e6 = Fun (<span class="st">&quot;x&quot;</span>, Fun (<span class="st">&quot;y&quot;</span>, If (ID <span class="st">&quot;x&quot;</span>, ID <span class="st">&quot;y&quot;</span>, Bool <span class="kw">false</span>)));; </span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> e7 = Fun (<span class="st">&quot;x&quot;</span>, Fun (<span class="st">&quot;y&quot;</span>, If (ID <span class="st">&quot;x&quot;</span>, Bool <span class="kw">true</span>, ID <span class="st">&quot;y&quot;</span>)));; </span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> e8 = Fun (<span class="st">&quot;x&quot;</span>, ID <span class="st">&quot;x&quot;</span>) </span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a> <span class="co">(* let polymorphism </span></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a><span class="co">    let f = fun x-&gt;x in f ( (f 1) = 5) </span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a><span class="co"> *)</span> </span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> e9 = </span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>    Let </span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>      ( <span class="st">&quot;f&quot;</span>, </span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>        Fun (<span class="st">&quot;x&quot;</span>, ID <span class="st">&quot;x&quot;</span>), </span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>        App (ID <span class="st">&quot;f&quot;</span>, Binop (Equal, Int <span class="dv">5</span>, App (ID <span class="st">&quot;f&quot;</span>, Int <span class="dv">1</span>))) );; </span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> e10 = Fun (<span class="st">&quot;x&quot;</span>, Binop (Add, Int <span class="dv">2</span>, ID <span class="st">&quot;x&quot;</span>));; </span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> e11 = Fun (<span class="st">&quot;f&quot;</span>, App (ID <span class="st">&quot;f&quot;</span>, Int <span class="dv">2</span>));; </span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> e12 = Fun (<span class="st">&quot;x&quot;</span>, Binop (Add, ID <span class="st">&quot;x&quot;</span>, ID <span class="st">&quot;x&quot;</span>));; </span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> e13 = App (e11, e12);; </span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a> string_of_exptype (compress (infer e11 []));;</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a># <span class="kw">type</span> exptype =</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>    TInt</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>  | TBool</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>  | TArrow <span class="kw">of</span> exptype * exptype</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>  | Guess_t <span class="kw">of</span> <span class="dt">int</span> * exptype <span class="dt">option</span> <span class="dt">ref</span></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a># <span class="kw">type</span> op = Add | Sub | Mult | Equal | NotEqual</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a># <span class="kw">type</span> var = <span class="dt">string</span></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a># <span class="kw">type</span> expr =</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>    Int <span class="kw">of</span> <span class="dt">int</span></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>  | Binop <span class="kw">of</span> op * expr * expr</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>  | Bool <span class="kw">of</span> <span class="dt">bool</span></span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>  | If <span class="kw">of</span> expr * expr * expr</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>  | ID <span class="kw">of</span> var</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>  | Fun <span class="kw">of</span> var * expr</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>  | App <span class="kw">of</span> expr * expr</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>  | Let <span class="kw">of</span> var * expr * expr</span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a># <span class="kw">val</span> string_of_exptype : exptype -&gt; <span class="dt">string</span> = &lt;<span class="kw">fun</span>&gt;</span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a># <span class="kw">type</span> &#39;a env = (var * &#39;a) <span class="dt">list</span></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a># <span class="kw">exception</span> TypeError <span class="kw">of</span> <span class="dt">string</span></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a># <span class="kw">val</span> error : <span class="dt">string</span> -&gt; &#39;a = &lt;<span class="kw">fun</span>&gt;</span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a># <span class="kw">val</span> extend : &#39;a env -&gt; var -&gt; &#39;a -&gt; &#39;a env = &lt;<span class="kw">fun</span>&gt;</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a># <span class="kw">val</span> lookup : &#39;a env -&gt; var -&gt; &#39;a = &lt;<span class="kw">fun</span>&gt;</span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a># <span class="kw">val</span> fresh_guess : <span class="dt">unit</span> -&gt; exptype = &lt;<span class="kw">fun</span>&gt;</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a># <span class="kw">val</span> compress : exptype -&gt; exptype = &lt;<span class="kw">fun</span>&gt;</span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a># <span class="kw">val</span> occurs : exptype <span class="dt">option</span> <span class="dt">ref</span> -&gt; exptype -&gt; <span class="dt">bool</span> = &lt;<span class="kw">fun</span>&gt;</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a># <span class="kw">val</span> unify : exptype -&gt; exptype -&gt; <span class="dt">unit</span> = &lt;<span class="kw">fun</span>&gt;</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a># <span class="kw">val</span> infer : expr -&gt; exptype env -&gt; exptype = &lt;<span class="kw">fun</span>&gt;</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a># <span class="kw">val</span> e1 : expr = Binop (Add, Int <span class="dv">3</span>, Binop (Mult, Int <span class="dv">4</span>, Int <span class="dv">2</span>))</span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a># <span class="kw">val</span> e2 : expr = Binop (Equal, Int <span class="dv">3</span>, Binop (Mult, Int <span class="dv">4</span>, Int <span class="dv">2</span>))</span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a># <span class="kw">val</span> e3 : expr = If (Bool <span class="kw">true</span>, Int <span class="dv">3</span>, Int <span class="dv">4</span>)</span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a># <span class="kw">val</span> e4 : expr = Let (<span class="st">&quot;x&quot;</span>, Int <span class="dv">1</span>, Binop (Add, Int <span class="dv">10</span>, ID <span class="st">&quot;x&quot;</span>))</span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a># <span class="kw">val</span> e5 : expr =</span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>  Let (<span class="st">&quot;f&quot;</span>, Fun (<span class="st">&quot;x&quot;</span>, Binop (Add, Int <span class="dv">3</span>, ID <span class="st">&quot;x&quot;</span>)), App (ID <span class="st">&quot;f&quot;</span>, Int <span class="dv">4</span>))</span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a># <span class="kw">val</span> e6 : expr = Fun (<span class="st">&quot;x&quot;</span>, Fun (<span class="st">&quot;y&quot;</span>, If (ID <span class="st">&quot;x&quot;</span>, ID <span class="st">&quot;y&quot;</span>, Bool <span class="kw">false</span>)))</span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a># <span class="kw">val</span> e7 : expr = Fun (<span class="st">&quot;x&quot;</span>, Fun (<span class="st">&quot;y&quot;</span>, If (ID <span class="st">&quot;x&quot;</span>, Bool <span class="kw">true</span>, ID <span class="st">&quot;y&quot;</span>)))</span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a># <span class="kw">val</span> e8 : expr = Fun (<span class="st">&quot;x&quot;</span>, ID <span class="st">&quot;x&quot;</span>)</span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> e9 : expr =</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>  Let (<span class="st">&quot;f&quot;</span>, Fun (<span class="st">&quot;x&quot;</span>, ID <span class="st">&quot;x&quot;</span>),</span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>   App (ID <span class="st">&quot;f&quot;</span>, Binop (Equal, Int <span class="dv">5</span>, App (ID <span class="st">&quot;f&quot;</span>, Int <span class="dv">1</span>))))</span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a># <span class="kw">val</span> e10 : expr = Fun (<span class="st">&quot;x&quot;</span>, Binop (Add, Int <span class="dv">2</span>, ID <span class="st">&quot;x&quot;</span>))</span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a># <span class="kw">val</span> e11 : expr = Fun (<span class="st">&quot;f&quot;</span>, App (ID <span class="st">&quot;f&quot;</span>, Int <span class="dv">2</span>))</span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a># <span class="kw">val</span> e12 : expr = Fun (<span class="st">&quot;x&quot;</span>, Binop (Add, ID <span class="st">&quot;x&quot;</span>, ID <span class="st">&quot;x&quot;</span>))</span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a># <span class="kw">val</span> e13 : expr =</span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>  App (Fun (<span class="st">&quot;f&quot;</span>, App (ID <span class="st">&quot;f&quot;</span>, Int <span class="dv">2</span>)),</span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>   Fun (<span class="st">&quot;x&quot;</span>, Binop (Add, ID <span class="st">&quot;x&quot;</span>, ID <span class="st">&quot;x&quot;</span>)))</span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a># </span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>Type:(<span class="dt">int</span>-&gt;?<span class="dv">1</span>)</span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>- : <span class="dt">string</span> = <span class="st">&quot;((int-&gt;?1)-&gt;?1)&quot;</span></span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
</p></blockquote></blockquote></div></p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Operational_Semantics.html" title="backward to &quot;8 Operational Semantics&quot;" data-pltdoc="x" rel="prev">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;CMSC 330 Lecture Notes&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>