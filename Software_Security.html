<!DOCTYPE html>
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>13&nbsp;Software Security</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="extra.css" title="default"/><link rel="stylesheet" type="text/css" href="faq.css" title="default"/><link rel="stylesheet" type="text/css" href="fancyverb.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">CMSC 330 Lecture Notes</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="intro.html" class="tocviewlink" data-pltdoc="x">Introduction</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="ocaml.html" class="tocviewlink" data-pltdoc="x">Functional Programming with OCaml</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="imperative-ocaml.html" class="tocviewlink" data-pltdoc="x">Imperative Programming with OCaml</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="pbt.html" class="tocviewlink" data-pltdoc="x">Property-<wbr></wbr>Based Randomized Testing (PBT)</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="regexp.html" class="tocviewlink" data-pltdoc="x">OCaml Regular Expressions</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="Finite_Automata.html" class="tocviewlink" data-pltdoc="x">Finite Automata</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="Context_Free_Grammars.html" class="tocviewlink" data-pltdoc="x">Context Free Grammars</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="Parsing.html" class="tocviewlink" data-pltdoc="x">Parsing</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="Operational_Semantics.html" class="tocviewlink" data-pltdoc="x">Operational Semantics</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="Type_Checking.html" class="tocviewlink" data-pltdoc="x">Type Checking</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="Lambda_Calculus.html" class="tocviewlink" data-pltdoc="x">Lambda Calculus</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="Rust.html" class="tocviewlink" data-pltdoc="x">Rust</a></td></tr><tr><td align="right">13&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Software Security</a></td></tr><tr><td align="right">14&nbsp;</td><td><a href="exercises.html" class="tocviewlink" data-pltdoc="x">OCaml Exercises</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>13&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Software Security</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">13.1&nbsp;</td><td><a href="#%28part._.Cybersecurity%29" class="tocviewlink" data-pltdoc="x">Cybersecurity</a></td></tr><tr><td align="right">13.2&nbsp;</td><td><a href="#%28part._.Threat_.Modeling%29" class="tocviewlink" data-pltdoc="x">Threat Modeling</a></td></tr><tr><td align="right">13.3&nbsp;</td><td><a href="#%28part._.Buffer_.Overflows%29" class="tocviewlink" data-pltdoc="x">Buffer Overflows</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">13.1<span class="stt">&nbsp;</span></span><a href="#%28part._.Cybersecurity%29" class="tocsubseclink" data-pltdoc="x">Cybersecurity</a></td></tr><tr><td><span class="tocsublinknumber">13.1.1<span class="stt">&nbsp;</span></span><a href="#%28part._.Cybersecurity_.Breaches%29" class="tocsubseclink" data-pltdoc="x">Cybersecurity Breaches</a></td></tr><tr><td><span class="tocsublinknumber">13.1.2<span class="stt">&nbsp;</span></span><a href="#%28part._.Vulnerabilities__.Security-relevant_.Defects%29" class="tocsubseclink" data-pltdoc="x">Vulnerabilities:<span class="mywbr"> &nbsp;</span> Security-<wbr></wbr>relevant Defects</a></td></tr><tr><td><span class="tocsublinknumber">13.1.2.1<span class="stt">&nbsp;</span></span><a href="#%28part._.Kinds_of_.Vulnerability%29" class="tocsubseclink" data-pltdoc="x">Kinds of Vulnerability</a></td></tr><tr><td><span class="tocsublinknumber">13.1.2.2<span class="stt">&nbsp;</span></span><a href="#%28part._.Correctness_vs__.Security%29" class="tocsubseclink" data-pltdoc="x">Correctness vs. Security</a></td></tr><tr><td><span class="tocsublinknumber">13.1.3<span class="stt">&nbsp;</span></span><a href="#%28part._.Building_.Security_.In%29" class="tocsubseclink" data-pltdoc="x">Building Security In</a></td></tr><tr><td><span class="tocsublinknumber">13.1.3.1<span class="stt">&nbsp;</span></span><a href="#%28part._.Adding_.Security_.On%29" class="tocsubseclink" data-pltdoc="x">Adding Security On</a></td></tr><tr><td><span class="tocsublinknumber">13.1.3.2<span class="stt">&nbsp;</span></span><a href="#%28part._.Designing_and_.Building_for_.Security__from_the_.Start%29" class="tocsubseclink" data-pltdoc="x">Designing and Building for Security, from the Start</a></td></tr><tr><td><span class="tocsublinknumber">13.2<span class="stt">&nbsp;</span></span><a href="#%28part._.Threat_.Modeling%29" class="tocsubseclink" data-pltdoc="x">Threat Modeling</a></td></tr><tr><td><span class="tocsublinknumber">13.2.1<span class="stt">&nbsp;</span></span><a href="#%28part._.The_.Lovely_and_.Dangerous_.Internet__in_.Brief%29" class="tocsubseclink" data-pltdoc="x">The Lovely and Dangerous Internet, in Brief</a></td></tr><tr><td><span class="tocsublinknumber">13.2.1.1<span class="stt">&nbsp;</span></span><a href="#%28part._.Clients_and_.Servers%29" class="tocsubseclink" data-pltdoc="x">Clients and Servers</a></td></tr><tr><td><span class="tocsublinknumber">13.2.1.2<span class="stt">&nbsp;</span></span><a href="#%28part._.Security_.Policies%29" class="tocsubseclink" data-pltdoc="x">Security Policies</a></td></tr><tr><td><span class="tocsublinknumber">13.2.2<span class="stt">&nbsp;</span></span><a href="#%28part._.Threats_to__.Internet-connected__.Computer_.Systems%29" class="tocsubseclink" data-pltdoc="x">Threats to (Internet-<wbr></wbr>connected) Computer Systems</a></td></tr><tr><td><span class="tocsublinknumber">13.2.2.1<span class="stt">&nbsp;</span></span><a href="#%28part._.As_a_.Normal_.Client%29" class="tocsubseclink" data-pltdoc="x">As a Normal Client</a></td></tr><tr><td><span class="tocsublinknumber">13.2.2.2<span class="stt">&nbsp;</span></span><a href="#%28part._.As_a__.Man_in_the_.Middle___.M.I.T.M_%29" class="tocsubseclink" data-pltdoc="x">As a "Man in the Middle" (MITM)</a></td></tr><tr><td><span class="tocsublinknumber">13.2.2.3<span class="stt">&nbsp;</span></span><a href="#%28part._.As_a_.Co-resident_.Service_user%29" class="tocsubseclink" data-pltdoc="x">As a Co-<wbr></wbr>resident Service/<span class="mywbr"> &nbsp;</span>user</a></td></tr><tr><td><span class="tocsublinknumber">13.3<span class="stt">&nbsp;</span></span><a href="#%28part._.Buffer_.Overflows%29" class="tocsubseclink" data-pltdoc="x">Buffer Overflows</a></td></tr><tr><td><span class="tocsublinknumber">13.3.1<span class="stt">&nbsp;</span></span><a href="#%28part._.What_is_a_.Buffer_.Overflow_%29" class="tocsubseclink" data-pltdoc="x">What is a Buffer Overflow?</a></td></tr><tr><td><span class="tocsublinknumber">13.3.2<span class="stt">&nbsp;</span></span><a href="#%28part._.Example__.Out-of-.Bounds_.Read_write_in_.O.Caml%29" class="tocsubseclink" data-pltdoc="x">Example:<span class="mywbr"> &nbsp;</span> Out-<wbr></wbr>of-<wbr></wbr>Bounds Read/<span class="mywbr"> &nbsp;</span>write in OCaml</a></td></tr><tr><td><span class="tocsublinknumber">13.3.3<span class="stt">&nbsp;</span></span><a href="#%28part._.Example__.Out-of-.Bounds_.Read_write_in_.C%29" class="tocsubseclink" data-pltdoc="x">Example:<span class="mywbr"> &nbsp;</span> Out-<wbr></wbr>of-<wbr></wbr>Bounds Read/<span class="mywbr"> &nbsp;</span>write in C</a></td></tr><tr><td><span class="tocsublinknumber">13.3.4<span class="stt">&nbsp;</span></span><a href="#%28part._.Exploiting_a_.Vulnerability%29" class="tocsubseclink" data-pltdoc="x">Exploiting a Vulnerability</a></td></tr><tr><td><span class="tocsublinknumber">13.3.5<span class="stt">&nbsp;</span></span><a href="#%28part._.What_.Can_.Exploitation_.Achieve_%29" class="tocsubseclink" data-pltdoc="x">What Can Exploitation Achieve?</a></td></tr><tr><td><span class="tocsublinknumber">13.3.5.1<span class="stt">&nbsp;</span></span><a href="#%28part._.Buffer_.Overread__.Heartbleed%29" class="tocsubseclink" data-pltdoc="x">Buffer Overread:<span class="mywbr"> &nbsp;</span> Heartbleed</a></td></tr><tr><td><span class="tocsublinknumber">13.3.5.2<span class="stt">&nbsp;</span></span><a href="#%28part._.Buffer_.Overwrite__.Morris_.Worm%29" class="tocsubseclink" data-pltdoc="x">Buffer Overwrite:<span class="mywbr"> &nbsp;</span> Morris Worm</a></td></tr><tr><td><span class="tocsublinknumber">13.3.5.2.1<span class="stt">&nbsp;</span></span><a href="#%28part._.Code_.Injection%29" class="tocsubseclink" data-pltdoc="x">Code Injection</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">9.0</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Rust.html" title="backward to &quot;12 Rust&quot;" data-pltdoc="x" rel="prev">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;CMSC 330 Lecture Notes&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="exercises.html" title="forward to &quot;14 OCaml Exercises&quot;" data-pltdoc="x" rel="next">next &rarr;</a></span>&nbsp;</div><section class="SsectionLevel2" id="section 13"><h2 class="heading">13<span class="stt">&nbsp;</span><a name="(part._.Software_.Security)"></a>Software Security<span class="button-group"><a href="#(part._.Software_.Security)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h2><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Cybersecurity%29" class="toclink" data-pltdoc="x">13.1<span class="hspace">&nbsp;</span>Cybersecurity</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Threat_.Modeling%29" class="toclink" data-pltdoc="x">13.2<span class="hspace">&nbsp;</span>Threat Modeling</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Buffer_.Overflows%29" class="toclink" data-pltdoc="x">13.3<span class="hspace">&nbsp;</span>Buffer Overflows</a></p></td></tr></table><section class="SsectionLevel3" id="section 13.1"><h3 class="heading">13.1<span class="stt">&nbsp;</span><a name="(part._.Cybersecurity)"></a>Cybersecurity<span class="button-group"><a href="#(part._.Cybersecurity)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><section class="SsectionLevel4" id="section 13.1.1"><h4 class="heading">13.1.1<span class="stt">&nbsp;</span><a name="(part._.Cybersecurity_.Breaches)"></a>Cybersecurity Breaches<span class="button-group"><a href="#(part._.Cybersecurity_.Breaches)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>Major security breaches of computer systems are a fact of life. They affect companies, governments, and individuals. Focusing on breaches of individuals&rsquo; information, consider just a few examples:</p><ul><li><p>Equifax (2017) - 145 million consumers&rsquo; records</p></li><li><p>Adobe (2013) - 150 million records, 38 million users</p></li><li><p>eBay (2014) - 145 million records</p></li><li><p>Anthem (2014) - Records of 80 million customers</p></li><li><p>Target (2013) - 110 million records</p></li><li><p>Heartland (2008) - 160 million records</p></li></ul></section><section class="SsectionLevel4" id="section 13.1.2"><h4 class="heading">13.1.2<span class="stt">&nbsp;</span><a name="(part._.Vulnerabilities__.Security-relevant_.Defects)"></a>Vulnerabilities: Security-relevant Defects<span class="button-group"><a href="#(part._.Vulnerabilities__.Security-relevant_.Defects)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>The causes of security breaches are varied but many of them, including those given above, owe to a <span style="font-weight: bold">defect</span> (or <span style="font-style: italic">bug</span>) or <span style="font-weight: bold">design flaw</span> in a targeted computer system&rsquo;s software. The software problem can be <span style="font-weight: bold">exploited</span> by an attacker. An <span style="font-weight: bold">exploit</span> is a particular, cleverly crafted input, or a series of (usually unintuitive) interactions with the system, which trigger the bug or flaw in a way that helps the attacker.</p><section class="SsectionLevel5" id="section 13.1.2.1"><h5 class="heading">13.1.2.1<span class="stt">&nbsp;</span><a name="(part._.Kinds_of_.Vulnerability)"></a>Kinds of Vulnerability<span class="button-group"><a href="#(part._.Kinds_of_.Vulnerability)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h5><p>One obvious sort of vulnerability is a bug in security policy enforcement code. For example, suppose you are implementing an operating system and you have code to enforce access control policies on files. This is the code that makes sure that if Alice&rsquo;s policy says that only she is allowed to edit certain files, then user Bob will not be allowed to modify them. Perhaps your enforcement code failed to consider a corner case, and as a result Bob is able to write those files even though Alice&rsquo;s policy says he shouldn&rsquo;t. This is a vulnerability.</p><p>A more surprising sort of vulnerability is a bug in code that seems to have nothing to do with enforcing security all. Nevertheless, by exploiting it the attacker can break security anyway. Exploits of such bugs have fun names such as <span style="font-weight: bold">buffer overflow</span>, <span style="font-weight: bold">SQL injection</span>, <span style="font-weight: bold">cross-site scripting (XSS)</span>, <span style="font-weight: bold">command injection</span>, among many more. We&rsquo;ll talk about these and others in this part of the course.</p></section><section class="SsectionLevel5" id="section 13.1.2.2"><h5 class="heading">13.1.2.2<span class="stt">&nbsp;</span><a name="(part._.Correctness_vs__.Security)"></a>Correctness vs. Security<span class="button-group"><a href="#(part._.Correctness_vs__.Security)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h5><p>The bugs underlying security exploits are, under normal circumstances, irritating. A normal user who stumbles across them will experience a crash or incorrect behavior.</p><p>But a key thing to observe is that <span style="font-weight: bold">an attacker is not a normal user!</span></p><p>A <span style="font-style: italic">normal user</span> will attempt to <span style="font-style: italic">avoid</span> triggering software defects, and when they do trigger them, the <span style="font-style: italic">effects</span> are oftentimes <span style="font-style: italic">benign</span>.</p><p>An <span style="font-style: italic">attacker</span> will actively attempt to <span style="font-style: italic">find</span> defects, using unusual interactions and features. When they find them, they will try to <span style="font-style: italic">exploit</span> them, to <span style="font-style: italic">deleterious effect.</span></p><p>Code that is material to a system&rsquo;s secure operation is called its <span style="font-weight: bold">trusted computing base</span> (TCB). This is the code that <span style="font-style: italic">must</span> be correct if the security of the entire system is to be assured. Not all code is part of the TCB. For example, perhaps your implementation of the <span style="font-weight: bold"><span class="stt">ls</span></span> command in your operating system mis-formats some of its output. This is irritating, but it doesn&rsquo;t compromise the operating system&rsquo;s security.</p><p>Thus, while it&rsquo;s expected that software will have bugs even after it&rsquo;s deployed (perfection is expensive!), bugs in the TCB are more problematic. These are bugs that an attacker will exploit to compromise your system, causing potentially significant damage. And these bugs can be in surprising places.</p></section></section><section class="SsectionLevel4" id="section 13.1.3"><h4 class="heading">13.1.3<span class="stt">&nbsp;</span><a name="(part._.Building_.Security_.In)"></a>Building Security In<span class="button-group"><a href="#(part._.Building_.Security_.In)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>What can we do about software that has vulnerabilities?</p><section class="SsectionLevel5" id="section 13.1.3.1"><h5 class="heading">13.1.3.1<span class="stt">&nbsp;</span><a name="(part._.Adding_.Security_.On)"></a>Adding Security On<span class="button-group"><a href="#(part._.Adding_.Security_.On)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h5><p>Security companies like Symantec, McAfee, FireEye, Cisco, Kaspersky, Tenable, and others propose to deal with vulnerabilities by providing a service that runs alongside target software. Their approach is to <span style="font-style: italic">add a layer of security on top of the software, separate from it.</span></p><p>For example, you can buy services that monitor your system and prevent vulnerabilities in resident software from being exploited. Or these services may attempt to mitigate the impact of exploitation. For example, a very specific kind of input may be required to exploit a vulnerability, and the security monitoring system can look for inputs like it, as defined by a <span style="font-style: italic">signature</span>. If an input matches the signature, the security system can block or modify it and thus stop the exploit.</p><p>But there are two problems with this approach:</p><ul><li><p>It is <span style="font-style: italic">retrospective</span>. It can only work once the vulnerability, and an exploit for it, is known. Then we can make a signature that blocks the exploit. Until the vulnerability is discovered and a signature is made for it, attackers will be able to successfully (and surreptitiously) exploit it.</p></li><li><p>It is <span style="font-style: italic">not (always) general</span>. Oftentimes there are many possible inputs that can exploit a vulnerability, and they may not all be described with an efficiently recognizable signature. As such, an attacker can bypass the monitoring system by making a change to the exploit that does not match the signature but still achieves the desired effect.</p></li></ul><p>In sum: While security monitoring is useful, it has not proven it to be effective at (completely) solving the security problem. There is more to do.</p></section><section class="SsectionLevel5" id="section 13.1.3.2"><h5 class="heading">13.1.3.2<span class="stt">&nbsp;</span><a name="(part._.Designing_and_.Building_for_.Security__from_the_.Start)"></a>Designing and Building for Security, from the Start<span class="button-group"><a href="#(part._.Designing_and_.Building_for_.Security__from_the_.Start)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h5><p>A more direct (and complementary) way of dealing with vulnerabilities is to avoid introducing them in the first place, when designing and writing the software. We call this approach <span style="font-weight: bold">Building Security In</span>. It requires that every software developer (this means you!) knows something about security and writes their code with a security mindset.</p><p>At a high level, building a system with a security mindset involves doing two things:</p><ul><li><p><span style="font-weight: bold">Model threats</span>. We need to think a little bit about how an attacker could influence or observe how our code is run. The process will clarify what we can assume about the trustworthiness of inputs our code receives, and the visibility of outputs our code produces (or how it produces them).</p></li><li><p><span style="font-weight: bold">Employ Defensive</span> <span style="font-style: italic"><span style="font-weight: bold">Design Patterns</span></span>. Based on the identified threats, we apply tried-and-true <span style="font-style: italic">design patterns</span> to defend against them. A design pattern is a kind of code template that we customize to the specifics of our software or situation. Sometimes this code pattern can be automatically introduced by a language, compiler, or framework, or we may need to write the code and customize the template ourselves.</p></li></ul><p>In the rest of this lecture, we will cover three broad topics:</p><ul><li><p>The basics of <span style="font-style: italic">threat modeling</span>.</p></li><li><p>Two kinds of <span style="font-style: italic">exploits</span>: <span style="font-weight: bold">Buffer overflows</span> and <span style="font-weight: bold">command injection</span>. Both of these are instances of the more general exploit pattern of <span style="font-weight: bold">code injection</span>, which we see again in the next lecture in the form of <span style="font-style: italic">SQL injection</span> and <span style="font-style: italic">cross-site scripting</span>.</p></li><li><p>Two kinds of <span style="font-style: italic">defense</span>: <span style="font-weight: bold">Type-safe programming languages</span>, and <span style="font-weight: bold">input validation</span>. The use of the former blocks buffer overflows and many other exploits. The latter is a design pattern often programmed by hand which aims to ensure that data influenced by a potential attacker cannot force our code to do the wrong thing. It defends against buffer overflows (when not already using a type-safe language), command injection, and many other code injection exploits.</p></li></ul></section></section></section><section class="SsectionLevel3" id="section 13.2"><h3 class="heading">13.2<span class="stt">&nbsp;</span><a name="(part._.Threat_.Modeling)"></a>Threat Modeling<span class="button-group"><a href="#(part._.Threat_.Modeling)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.The_.Lovely_and_.Dangerous_.Internet__in_.Brief%29" class="toclink" data-pltdoc="x">13.2.1<span class="hspace">&nbsp;</span>The Lovely and Dangerous Internet, in Brief</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Threats_to__.Internet-connected__.Computer_.Systems%29" class="toclink" data-pltdoc="x">13.2.2<span class="hspace">&nbsp;</span>Threats to (Internet-connected) Computer Systems</a></p></td></tr></table><p>Avoiding attacks means understanding what attackers can do, and putting mechanisms in place to stop them from doing things you don&rsquo;t want. Broadly speaking, this is the process of <span style="font-style: italic">threat modeling</span>.</p><section class="SsectionLevel4" id="section 13.2.1"><h4 class="heading">13.2.1<span class="stt">&nbsp;</span><a name="(part._.The_.Lovely_and_.Dangerous_.Internet__in_.Brief)"></a>The Lovely and Dangerous Internet, in Brief<span class="button-group"><a href="#(part._.The_.Lovely_and_.Dangerous_.Internet__in_.Brief)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>For those interested in widespread, diverse, and innovative services and information, the Internet is an incredible blessing. For those aiming to defend services from attack, the Internet is a curse. This is because the Internet makes services available to just about anyone, oftentimes without any sort of accountability &#8212;<wbr></wbr> potential attackers can probe and prod many Internet services essentially without risk. Understanding what they can do is important for writing software accessible via the Internet. If you think your software won&rsquo;t be connected to the Internet, you might think again; sooner or later it will end up there.</p><section class="SsectionLevel5" id="section 13.2.1.1"><h5 class="heading">13.2.1.1<span class="stt">&nbsp;</span><a name="(part._.Clients_and_.Servers)"></a>Clients and Servers<span class="button-group"><a href="#(part._.Clients_and_.Servers)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h5><p>Most sessions over the internet can view as a simplified interaction between clients and servers.</p><ul><li><p>The <span style="font-style: italic">client</span> seeks to use a network-connected services, e.g., using a web browser, ssh client, specialized app, etc. to exchange messages with that service, over the Internet</p></li><li><p>Services are provided by a remote machine called the <span style="font-style: italic">server.</span> Oftentimes there is a pool of such machines, but the client won&rsquo;t necessarily see that &#8212;<wbr></wbr> they just visit store.com, not realizing that each interaction might go to a different server on a different machine.</p></li></ul><p>Both the client and server have resources that need protection.</p><p>The client may be on a machine with personal financial information, private records, browsing history, etc. The server will host valuable information as part of the service it is offering, such as bank account balances, student grades, personnel records, etc. Even the computing resources themselves may be valuable; e.g., an attacker could attempt to surreptitiously use a client&rsquo;s machine to send spam or carry out illicit activities.</p></section><section class="SsectionLevel5" id="section 13.2.1.2"><h5 class="heading">13.2.1.2<span class="stt">&nbsp;</span><a name="(part._.Security_.Policies)"></a>Security Policies<span class="button-group"><a href="#(part._.Security_.Policies)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h5><p>The client and server resources warrant, roughly speaking, three kinds of protection:</p><ul><li><p><span style="font-weight: bold">Confidentiality</span>. A confidentiality (aka privacy) policy states that a resource should not be readable by just anyone. Only certain users/actors should have access to the information. For example, my personal information, whether stored at a client or server, should be kept private, and not be leaked.</p></li><li><p><span style="font-weight: bold">Integrity</span>. An integrity policy indicates which parties may add to or modify a resource. For example, my bank account balance should be changeable only by me or the bank, and the change should only be via agreed-upon mechanisms, e.g., deposits or withdrawals, or certain fees.</p></li><li><p><span style="font-weight: bold">Availability</span>. An availability policy states that protected resources should not be unreasonably inaccessible. Having money at the bank but then not being able to access it for a long period would be a violation of availability. If an attacker managed to get an account on my machine and started using it to send spam, that would also be a violation of availability, because now (some of) my machine is not available for my own use.</p></li></ul><p>We will see that by exploiting software vulnerabilities, attackers are able to violate any and all of these policies.</p></section></section><section class="SsectionLevel4" id="section 13.2.2"><h4 class="heading">13.2.2<span class="stt">&nbsp;</span><a name="(part._.Threats_to__.Internet-connected__.Computer_.Systems)"></a>Threats to (Internet-connected) Computer Systems<span class="button-group"><a href="#(part._.Threats_to__.Internet-connected__.Computer_.Systems)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>What are the ways that an attacker can cause problems? These three are typical.</p><section class="SsectionLevel5" id="section 13.2.2.1"><h5 class="heading">13.2.2.1<span class="stt">&nbsp;</span><a name="(part._.As_a_.Normal_.Client)"></a>As a Normal Client<span class="button-group"><a href="#(part._.As_a_.Normal_.Client)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h5><p>An attacker can interact with an Internet service via the same channel allotted to normal users. If a normal user of an on-line store browse the store&rsquo;s products, make purchases, leave reviews, submit support requests, etc. then so can an attacker.</p><p>Of course, an attacker will attempt to perform these actions in weird and wonderful ways in an attempt to exploit potential vulnerabilities. Attackers will not limit themselves to using standard tools and will not follow instructions. For example:</p><ul><li><p>Instead of using an Internet browser, an attacker may craft network messages by hand, perhaps ones that are too long or use unusual characters.</p></li><li><p>Instead of always following the expected process, the attacker will try things that are off the beaten path. For example, rather than go to store.com via a browser, and then type in a username/password, and then click a link to go to a page, the attacker may skip the login page entirely and just type in the URL of the desired page, to attempt to bypass the authentication process.</p></li></ul><p>Thus, designers and implementers of computer systems need to think about the limits of what is possible, not just what is expected, to properly defend against a malicious client.</p></section><section class="SsectionLevel5" id="section 13.2.2.2"><h5 class="heading">13.2.2.2<span class="stt">&nbsp;</span><a name="(part._.As_a__.Man_in_the_.Middle___.M.I.T.M_)"></a>As a "Man in the Middle" (MITM)<span class="button-group"><a href="#(part._.As_a__.Man_in_the_.Middle___.M.I.T.M_)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h5><p>Normal clients can send messages to and from the server, but are normally oblivious to the interactions the server might be having with other clients. A more powerful kind of attacker can observe such interactions and potentially corrupt or manipulate them. Traditionally, such an attacker is called a Man in the Middle (MITM) because they can sit in between two (or more) communicating parties.</p><p>This sort of situation is more common than you might think because of the prevalence of wireless networks. It is not hard to observe messages being sent around on that network, since it uses a broadcast medium. If you are connected to the public network at a coffee shop, then someone else connected to that same network may be looking at the messages you send and receive.</p><p>The typical defense against this kind of attacker is to use cryptography. By using <span style="font-style: italic">encryption</span>, even if the attacker can see your messages, they can&rsquo;t make sense of them (ensures confidentiality). By using <span style="font-style: italic">digital signatures</span> (<span style="font-style: italic">aka</span> <a href="https://en.wikipedia.org/wiki/Message_authentication_code">message authentication codes</a>, or <span style="font-style: italic">MAC</span>s), even if the attacker can modify your messages, the receiver will be able to detect the modifications (ensures integrity). Additional defenses are also sometimes required, e.g., the use of <span style="font-style: italic">nonces</span> to detect the potential <span style="font-style: italic">replay</span> of messages.</p><p>We will not discuss cryptography or MITM-style attacks in this course. If you are interested in learning more, check out <a href="https://academiccatalog.umd.edu/search/?P=CMSC456">CMSC 456</a> and <a href="https://academiccatalog.umd.edu/search/?P=CMSC414">CMSC 414</a>.</p></section><section class="SsectionLevel5" id="section 13.2.2.3"><h5 class="heading">13.2.2.3<span class="stt">&nbsp;</span><a name="(part._.As_a_.Co-resident_.Service_user)"></a>As a Co-resident Service/user<span class="button-group"><a href="#(part._.As_a_.Co-resident_.Service_user)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h5><p>Sometimes an attacker can do more than just communicate via the same network as the target; they can have direct access to the same machine.</p><p>In multi-user operating systems, such as Linux or MacOs, an attacker can log in as one user in an attempt to steal or manipulate information belonging to another. In today&rsquo;s cloud computing environments, like Microsoft&rsquo;s Azure or Amazon&rsquo;s Web Services (AWS), a target may be running a <a href="https://en.wikipedia.org/wiki/System_virtual_machine">virtual machine</a> instance on the same host as one run by the attacker. Mobile code technologies enable attacker-provided code to run directly on the target machine. For example, an attacker could try to upload a malicious Javascript program to a web site that is visited by a potential victim, who will unknowingly download and run the program in their browser when they visit the site.</p><p>In these cases, co-residency means an attacker can observe or modify resources shared or even directly owned by the target, such as memory or stable storage (files), in such a way as to achieve his goals.</p></section></section></section><section class="SsectionLevel3" id="section 13.3"><h3 class="heading">13.3<span class="stt">&nbsp;</span><a name="(part._.Buffer_.Overflows)"></a>Buffer Overflows<span class="button-group"><a href="#(part._.Buffer_.Overflows)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.What_is_a_.Buffer_.Overflow_%29" class="toclink" data-pltdoc="x">13.3.1<span class="hspace">&nbsp;</span>What is a Buffer Overflow?</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Example__.Out-of-.Bounds_.Read_write_in_.O.Caml%29" class="toclink" data-pltdoc="x">13.3.2<span class="hspace">&nbsp;</span>Example: Out-of-Bounds Read/write in OCaml</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Example__.Out-of-.Bounds_.Read_write_in_.C%29" class="toclink" data-pltdoc="x">13.3.3<span class="hspace">&nbsp;</span>Example: Out-of-Bounds Read/write in C</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Exploiting_a_.Vulnerability%29" class="toclink" data-pltdoc="x">13.3.4<span class="hspace">&nbsp;</span>Exploiting a Vulnerability</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.What_.Can_.Exploitation_.Achieve_%29" class="toclink" data-pltdoc="x">13.3.5<span class="hspace">&nbsp;</span>What Can Exploitation Achieve?</a></p></td></tr></table><section class="SsectionLevel4" id="section 13.3.1"><h4 class="heading">13.3.1<span class="stt">&nbsp;</span><a name="(part._.What_is_a_.Buffer_.Overflow_)"></a>What is a Buffer Overflow?<span class="button-group"><a href="#(part._.What_is_a_.Buffer_.Overflow_)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>A <span style="font-style: italic">buffer overflow</span> describes a family of possible exploits of a vulnerability in which a program may incorrectly access a buffer outside its allotted bounds. A <span style="font-style: italic">buffer overwrite</span> occurs when the out-of-bounds access is a write. A <span style="font-style: italic">buffer overread</span> occurs when the access is a read.</p><p>The key question is: <span style="font-weight: bold">What happens when an out-of-bounds access occurs?</span></p><p>If your program is written in a <a href="http://www.pl-enthusiast.net/2014/07/21/memory-safety/">memory-safe</a> or <a href="http://www.pl-enthusiast.net/2014/08/05/type-safety/">type-safe</a> programming language, some important attacks are taken off the table; if it is not, then there are fairly dire security implications, as we will see.</p></section><section class="SsectionLevel4" id="section 13.3.2"><h4 class="heading">13.3.2<span class="stt">&nbsp;</span><a name="(part._.Example__.Out-of-.Bounds_.Read_write_in_.O.Caml)"></a>Example: Out-of-Bounds Read/write in OCaml<span class="button-group"><a href="#(part._.Example__.Out-of-.Bounds_.Read_write_in_.O.Caml)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>Consider the following simple program, written in <a href="https://ocaml.org/">OCaml</a>. There&rsquo;s a bug in this code; can you spot it?</p><p><div class='fancy-box'><div class="sourceCode" id="cb1"><pre
class="sourceCode ocaml"><code class="sourceCode ocaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="kw">rec</span> incr_arr x i len =</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> i &gt;= <span class="dv">0</span> &amp;&amp; i &lt; len <span class="kw">then</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    (x.(i) &lt;- x.(i) + <span class="dv">1</span>;</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    incr_arr x (i+<span class="dv">1</span>) len)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>;;</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> y = <span class="dt">Array</span>.make <span class="dv">10</span> <span class="dv">1</span>;;</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>incr_arr y <span class="dv">0</span> (<span class="dv">1</span> + <span class="dt">Array</span>.length y);;</span></code></pre></div>
</div></p><p>The function <span class="stt">incr_arr</span> iterates over an <a href="https://ocaml.org/releases/4.07/htmlman/libref/Array.html">OCaml array</a>, adding <span class="stt">1</span> to each of its elements. The code creates an array <span class="stt">y</span> of size 10, with each element initialized to 1. It then calls <span class="stt">incr_arr</span> on this array. What happens?</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">Exception: Invalid_argument "index out of bounds".</span></p></td></tr></table></p><p>The bug is on line 8: the code should pass <span class="stt">Array.length y</span> as the third argument to <span class="stt">incr_arr</span>, but instead passes that expression, plus 1. As such, <span class="stt">incr_arr</span> will read (and attempt to write) one past the end of the array, which the program detects and signals by throwing an exception.</p></section><section class="SsectionLevel4" id="section 13.3.3"><h4 class="heading">13.3.3<span class="stt">&nbsp;</span><a name="(part._.Example__.Out-of-.Bounds_.Read_write_in_.C)"></a>Example: Out-of-Bounds Read/write in C<span class="button-group"><a href="#(part._.Example__.Out-of-.Bounds_.Read_write_in_.C)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>Here&rsquo;s our buggy example again but this time written in C.</p><p><div class='fancy-box'><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> incr_arr<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>x<span class="op">,</span> <span class="dt">int</span> len<span class="op">,</span> <span class="dt">int</span> i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>i <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> len<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    x<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> x<span class="op">[</span>i<span class="op">]</span> <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    incr_arr<span class="op">(</span>x<span class="op">,</span>len<span class="op">,</span>i<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> y<span class="op">[</span><span class="dv">10</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">};</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> z <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  incr_arr<span class="op">(</span>y<span class="op">,</span><span class="dv">11</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st"> =? 20</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span>z<span class="op">);</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div></p><p>As in the OCaml version, the code in <span class="stt">main</span> invokes <span class="stt">incr_arr</span> with array <span class="stt">y</span>, but after calling the function, <span class="stt">main</span> also prints out the value of another variable, <span class="stt">z</span>. As in the OCaml version, the array <span class="stt">y</span> that is being passed to <span class="stt">incr_arr</span> has length 10, but the second argument is given as 11, which is one more than it should be. As a result, line 5 will be allowed to read/write past the end of the array.</p><p>In our OCaml version, running the program resulted in an exception being thrown; what will happen in this C version?</p><p>I can compile this program with the <span class="stt">clang</span> C compiler (no optimizations) on my Mac to produce the executable <span class="stt">a.out</span>. When I run <span class="stt">a.out</span>, it completes normally, outputting the following:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">21 =? 20</span></p></td></tr></table></p><p>What happened?</p><p>Basically, when <span class="stt">incr_arr</span> read <span class="stt">x[10]</span> on line 5 (i.e., when argument <span class="stt">i == 10</span>), the function read the contents (<span class="stt">20</span>) of <span class="stt">z</span>, since it happens to be allocated in memory just past the end of <span class="stt">y</span> (the memory that <span class="stt">x</span> is pointing to). Then line 5 added 1 to what it read, and wrote the result (<span class="stt">21</span>) back to <span class="stt">z</span>, which is printed by <span class="stt">main</span>.</p><p>When we fix the bug (by changing line 14 to be <span class="stt">incr_arr(y,10,0);</span>), the program prints the following instead, since <span class="stt">z</span> is no longer modified:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">20 =? 20</span></p></td></tr></table></p><p>To recap: In OCaml, reading/writing outside the bounds of a buffer <span style="font-style: italic">always</span> results in an exception, and the program halts. In C, reading/writing outside the bounds of the buffer is <span style="font-style: italic">not</span> guaranteed to cause an exception. Instead, basically anything could happen. Here, we saw that adjacent memory can be read or modified.</p></section><section class="SsectionLevel4" id="section 13.3.4"><h4 class="heading">13.3.4<span class="stt">&nbsp;</span><a name="(part._.Exploiting_a_.Vulnerability)"></a>Exploiting a Vulnerability<span class="button-group"><a href="#(part._.Exploiting_a_.Vulnerability)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>When an application has a bug in it that allows the program to access a buffer outside its bounds, an attacker can try to exploit it. He does this by controlling the input to the program in a way that triggers the bug to his advantage.</p><p>In our example, the program always fails, so that&rsquo;s not very interesting. But what if we changed <span class="stt">main</span> to be the following?</p><p><div class='fancy-box'><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> len <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>argc <span class="op">==</span> <span class="dv">2</span><span class="op">)</span> len <span class="op">=</span> atoi<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  incr_arr<span class="op">(</span>y<span class="op">,</span>len<span class="op">,</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st"> =? 20</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span>z<span class="op">);</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div></p><p>If we run the compiled program <span class="stt">a.out</span> with no arguments, then it works as expected (the guard on line 4 is false). But suppose we run it thusly.</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">a.out 11</span></p></td></tr></table></p><p>Since <span class="stt">argc == 2</span>, the guard on line 4 is true so it sets <span class="stt">len</span> to be 11. Thus the call to <span class="stt">incr_arr</span> on line 5 is the same buggy one we saw in the original version of our buggy C program, and <span class="stt">z</span> will be overwritten.</p><p>An attacker can exploit the bug if he can influence what (and whether) the argument is passed to <span class="stt">a.out</span>. If he can force the argument to be 11 (or more), then he can trigger the bug.</p></section><section class="SsectionLevel4" id="section 13.3.5"><h4 class="heading">13.3.5<span class="stt">&nbsp;</span><a name="(part._.What_.Can_.Exploitation_.Achieve_)"></a>What Can Exploitation Achieve?<span class="button-group"><a href="#(part._.What_.Can_.Exploitation_.Achieve_)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>To recap: Suppose my program has a bug in it that allows reading or writing outside the bounds of a buffer, and the attacker is able to control that happening, at least to some degree. What can the attacker achieve?</p><section class="SsectionLevel5" id="section 13.3.5.1"><h5 class="heading">13.3.5.1<span class="stt">&nbsp;</span><a name="(part._.Buffer_.Overread__.Heartbleed)"></a>Buffer Overread: Heartbleed<span class="button-group"><a href="#(part._.Buffer_.Overread__.Heartbleed)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h5><p><span style="font-style: italic">Heartbleed</span> is a bug in the popular, open-source <a href="https://www.openssl.org/">OpenSSL</a> codebase that is used by a substantial number of Internet clients and servers to carry out secure communication, e.g., as part of the <a href="https://en.wikipedia.org/wiki/HTTPS">HTTPS protocol</a>. By <a href="https://twitter.com/colmmacc/status/1114951109825658881?s=20">one account</a>, Heartbleed "made more headlines and news articles in one day than any war had since Vietnam." Now it has its <a href="https://heartbleed.com/">own website</a>!</p><p>This XKCD comic explains it very well:</p><p><img src="heartbleed_explanation.png" alt="" width="640" height="1364"/></p><p>Heartbleed&rsquo;s operation is not so different than our previously developed example.</p><p>In that example, the <span class="stt">a.out</span> program can be invoked with an argument that specifies the claimed length. As we saw, the length could be wrong! This means that if the attacker is able to run <span class="stt">a.out</span> with a given length that&rsquo;s greater than the actual length of the buffer (i.e., 11 or more), then the attacker can cause the buffer to be read (and written) outside its bounds, accessing nearby memory when that happens.</p><p>In Heartbleed, the attacker (the person, in the XKCD cartoon) acts as the client. It sends a "heartbeat" message to the victim server (the machine, in the cartoon). This message includes some text, and specifies the length of the text. The machine writes the client&rsquo;s text to a buffer and then sends a message back with the contents of the buffer, which contains that text. Crucially, the machine asks the client to specify a length along with the text, and this length can be wrong! Just as with our example, if the specified length is greater than the actual length of the provided text, the server will just send back whatever happens to be in memory beyond the end of the buffer.</p><p>As it turns out, this memory could contain very sensitive information, such as secret cryptographic keys or passwords, perhaps provided by previous clients. Due to OpenSSL&rsquo;s popularity, many Internet servers needed to be shut down and patched, and public cryptographic key certificates that they used to authenticate their identity needed to be reissued, out of fears that exploits of Heartbleed may have stolen them.</p></section><section class="SsectionLevel5" id="section 13.3.5.2"><h5 class="heading">13.3.5.2<span class="stt">&nbsp;</span><a name="(part._.Buffer_.Overwrite__.Morris_.Worm)"></a>Buffer Overwrite: Morris Worm<span class="button-group"><a href="#(part._.Buffer_.Overwrite__.Morris_.Worm)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h5><p>The Morris Worm was the work of Robert Morris, a computer science student at Cornell University. <a href="https://spaf.cerias.purdue.edu/tech-reps/823.pdf">Occurring in 1988, it is one of the first widely acknowledged (and impactful) uses of a buffer overflow exploit</a> (in the program <a href="https://en.wikipedia.org/wiki/Finger_protocol">fingerd</a>) for the purposes of injecting code.</p><p>As described in <a href="http://computerarcheology.com/Virus/MorrisWorm/">this article</a>, the exploit worked by sending a larger message to the <span class="stt">fingerd</span> program than it expected to ever receive. In particular, the program pre-allocated a buffer of size 500 in a local variable in <span class="stt">main</span>. The exploit sent to the program an input that filled that buffer with 536 bytes of data &#8212;<wbr></wbr> more than it could hold. As a result, the extra bytes spilled out and overwrote other parts of the call stack, including <span class="stt">main</span>&rsquo;s return address. Therefore, when the <span class="stt">main</span> function completed, instead of properly returning to its caller, it "returned" to an address placed by the attacker.</p><p>Cleverly, the exploit chose to overwrite the return address with a value that pointed <span style="font-style: italic">inside the just-overflowed buffer</span>, so that after the return, the contents of that buffer were treated by the machine as code. This code was also cleverly chosen so that when executed it performs <span class="stt">execve("/bin/sh",0,0)</span>; i.e., it turns the current program into a shell running on the attacked system. This attack came to be known as a <a href="https://inst.eecs.berkeley.edu/~cs161/fa08/papers/stack_smashing.pdf"><span style="font-style: italic">stack smashing attack</span></a> and the attack&rsquo;s payload came to be known as <a href="https://en.wikipedia.org/wiki/Shellcode">shellcode</a>.</p><p>Buffer overwrites are also dangerous even when stack smashing (or similar sorts of code injection attacks) are not possible. Returning to our example, imagine that the variable <span class="stt">z</span> represented a flag that indicates whether a user has been authorized to carry out a sensitive operation. By overflowing buffer <span class="stt">y</span>, an unauthorized user will be granted excess privilege.</p><section class="SsectionLevel6" id="section 13.3.5.2.1"><h5 class="heading">13.3.5.2.1<span class="stt">&nbsp;</span><a name="(part._.Code_.Injection)"></a>Code Injection<span class="button-group"><a href="#(part._.Code_.Injection)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h5><p>The Morris Worm exploit aims to perform <span style="font-weight: bold">code injection</span>. It works by tricking the program to treat attacker-provided data as code. Buffer overflows are one vector to doing code injection, where the injected code is machine code. But it is not the only one, as we will see later; others include</p><ul><li><p>SQL injection</p></li><li><p>Command injection</p></li><li><p>Cross-site scripting</p></li><li><p>Use-after-free (violating Temporal Safety)</p></li><li><p>... and many others are a kind of bug, coupled with an exploit that aims to inject code of the attacker&rsquo;s choice.</p></li></ul><p>How can we defeat them?</p></section></section></section></section></section><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Rust.html" title="backward to &quot;12 Rust&quot;" data-pltdoc="x" rel="prev">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;CMSC 330 Lecture Notes&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="exercises.html" title="forward to &quot;14 OCaml Exercises&quot;" data-pltdoc="x" rel="next">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>